#!/bin/bash

set -euo pipefail

packages=(
  sway swaybg swayidle swaylock waybar sway-wallpapers
  #grim grimshot slurp i3status i3status-rs
  grim grimshot slurp i3status
  wofi rofi-wayland dex-autostart
  # need ruby in the base system so that ruby scripts have easy access to
  # swaymsg and the sway socket
  ruby
  brightnessctl lxpolkit
  pamixer

  # fzf history search needs perl
  fzf perl
  tmux

  zenity
)

packages_remove=(
  firefox
  firefox-langpacks
)

fedora_version=$(rpm -E %fedora)

if [ -d ~/scripts/local-sway.d ]; then
    for part in ~/scripts/local-sway.d/*.part; do
        if [ -f "$part" ]; then
            echo $part
            . "$part"
        fi
    done
fi
unset part

set -x

rpm-ostree override remove "${packages_remove[@]}" || true
rpm-ostree install --idempotent -y "${packages[@]}"

sudo rpm-ostree apply-live --allow-replacement
